<!DOCTYPE html>
<html lang="id">
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Frame Camera Full HD</title>

<style>
    body, html {
        margin:0;
        padding:0;
        overflow:hidden;
        background:#000;
        font-family: Arial, sans-serif;
    }

    #container {
        position: relative;
        width: 100vw;
        height: 100vh;
        overflow: hidden;
        background:#000;
    }

    video {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 100vw;
        height: 100vh;
        object-fit: cover;
    }

    #frame {
        position: absolute;
        top:0;
        left:0;
        width:100%;
        height:100%;
        pointer-events:none;
        object-fit: contain;
    }

    #controls {
        position: absolute;
        bottom: 20px;
        width: 100%;
        text-align: center;
        z-index: 10;
    }

    button {
        background: white;
        padding: 15px 25px;
        border-radius: 12px;
        border: none;
        font-size: 18px;
        margin: 5px;
    }
</style>
</head>

<body>

<div id="container">
    <video id="video" autoplay playsinline></video>
    <img id="frame" src="frame.png">
</div>

<div id="controls">
    <button id="captureBtn">Foto</button>
    <button id="recordBtn">Rekam</button>
</div>

<script>
let video = document.getElementById("video");
let captureBtn = document.getElementById("captureBtn");
let recordBtn = document.getElementById("recordBtn");
let recorder, recordedChunks = [];
let isRecording = false;

// ===============================
// START CAMERA BACK
// ===============================
async function startCamera() {
    try {
        const stream = await navigator.mediaDevices.getUserMedia({
            video: {
                width: { ideal: 1080 },
                height: { ideal: 1920 },
                facingMode: { exact: "environment" }
            },
            audio: true
        });

        video.srcObject = stream;

    } catch (err) {
        console.warn("Back camera gagal, coba kamera default");
        const stream = await navigator.mediaDevices.getUserMedia({
            video: true,
            audio: true
        });
        video.srcObject = stream;
    }
}
startCamera();

// ===============================
// FOTO FULL HD + FRAME
// ===============================
captureBtn.onclick = function () {
    let canvas = document.createElement("canvas");
    canvas.width = 1080;
    canvas.height = 1920;
    let ctx = canvas.getContext("2d");

    // Gambar video
    ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

    // Gambar frame PNG
    let frame = document.getElementById("frame");
    ctx.drawImage(frame, 0, 0, canvas.width, canvas.height);

    let url = canvas.toDataURL("image/png");
    download(url, "foto.png");
};

// ===============================
// VIDEO WEBM + FRAME
// ===============================
recordBtn.onclick = function () {
    if (!isRecording) {
        startRecording();
    } else {
        stopRecording();
    }
};

function startRecording() {
    isRecording = true;
    recordBtn.innerText = "Stop";

    recordedChunks = [];

    let stream = video.srcObject;

    recorder = new MediaRecorder(stream, {
        mimeType: "video/webm; codecs=vp9",
        videoBitsPerSecond: 8000000 // kualitas tinggi
    });

    recorder.ondataavailable = e => recordedChunks.push(e.data);

    recorder.onstop = async () => {
        let blob = new Blob(recordedChunks, { type: "video/webm" });

        let url = URL.createObjectURL(blob);
        download(url, "video.webm");
    };

    recorder.start();
}

function stopRecording() {
    isRecording = false;
    recordBtn.innerText = "Rekam";
    recorder.stop();
}

function download(url, filename) {
    let a = document.createElement("a");
    a.href = url;
    a.download = filename;
    a.click();
}
</script>

</body>
</html>
