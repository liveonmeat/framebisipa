<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>SnapCam 1080x1920</title>

<style>
    body, html {
        margin: 0; padding: 0;
        width: 100%; height: 100%;
        background: #000;
        overflow: hidden;
        font-family: Arial, sans-serif;
    }

    #preview {
        position: fixed;
        width: 100%;
        height: 100%;
        object-fit: cover;
        background: #000;
    }

    #frame {
        position: fixed;
        top: 0; left: 0;
        width: 100%; height: 100%;
        pointer-events: none;
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
    }

    #captureBtn {
        position: fixed;
        bottom: 40px;
        left: 50%;
        transform: translateX(-50%);
        width: 85px; height: 85px;
        border-radius: 50%;
        background: white;
        border: 4px solid #ddd;
        box-shadow: 0 0 5px #000;
    }

    #captureBtn:active {
        transform: translateX(-50%) scale(0.9);
    }
</style>
</head>

<body>

<video id="preview" autoplay playsinline></video>
<div id="frame"></div>

<button id="captureBtn"></button>

<script>
const preview = document.getElementById("preview");
const frame = document.getElementById("frame");
const captureBtn = document.getElementById("captureBtn");

let mediaStream;
let mediaRecorder;
let chunks = [];
let isRecording = false;
let pressTimer;

// SET FRAME (KALAU ADA GAMBAR OVERLAY)
// frame.style.backgroundImage = "url(frame.png)"; // opsional

// =============================
// START CAMERA
// =============================
async function startCamera() {
    mediaStream = await navigator.mediaDevices.getUserMedia({
        video: {
            facingMode: "user",
            width: { ideal: 1080 },
            height: { ideal: 1920 }
        },
        audio: true
    });

    preview.srcObject = mediaStream;
}

startCamera();

// =============================
// TAKE PHOTO
// =============================
function takePhoto() {
    const video = preview;
    const canvas = document.createElement("canvas");
    canvas.width = 1080;
    canvas.height = 1920;

    const ctx = canvas.getContext("2d");
    ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

    canvas.toBlob((blob) => {
        const url = URL.createObjectURL(blob);
        downloadFile(url, "photo.jpg");
    }, "image/jpeg", 0.95);
}

// =============================
// START RECORDING
// =============================
function startRecord() {
    chunks = [];
    mediaRecorder = new MediaRecorder(mediaStream, {
        mimeType: "video/mp4"   // iPhone & Android support mp4
    });

    mediaRecorder.ondataavailable = e => chunks.push(e.data);

    mediaRecorder.onstop = () => {
        const blob = new Blob(chunks, { type: "video/mp4" });
        const url = URL.createObjectURL(blob);
        downloadFile(url, "video.mp4");
    };

    mediaRecorder.start();
    isRecording = true;
}

// =============================
// STOP RECORDING
// =============================
function stopRecord() {
    if (mediaRecorder && isRecording) {
        mediaRecorder.stop();
        isRecording = false;
    }
}

// =============================
// DOWNLOAD FILE
// =============================
function downloadFile(url, filename) {
    const a = document.createElement("a");
    a.href = url;
    a.download = filename;
    a.click();
    URL.revokeObjectURL(url);
}

// =============================
// BUTTON HANDLER
// =============================

// PRESS = PHOTO
// HOLD = RECORD
captureBtn.addEventListener("touchstart", startPress);
captureBtn.addEventListener("mousedown", startPress);

captureBtn.addEventListener("touchend", endPress);
captureBtn.addEventListener("mouseup", endPress);
captureBtn.addEventListener("mouseleave", endPress);

function startPress() {
    pressTimer = setTimeout(() => {
        startRecord();
    }, 300); // tahan 0.3 detik = mulai rekam
}

function endPress() {
    clearTimeout(pressTimer);

    if (isRecording) {
        stopRecord(); // stop video
    } else {
        takePhoto(); // klik cepat = foto
    }
}
</script>

</body>
</html>
